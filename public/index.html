<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Team Page</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div id="app">
    <div class="pageContainer">
      <!-- ===== HEADER / LOGO ===== -->
      <div id="logoContainer">
        <a href="https://sites.google.com/friendsofportlandnet.org/teamspace/home">
          <img id="logo" alt="Friends of Portland NET" src="/img/logo.png">
        </a>
      </div>
    </div>

    <!-- ===== LOADING SPINNER ===== -->
      <div id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading team data...</p>
      </div>


    <!-- ===== TEAMLINKS ===== -->
    <div id="linksContent" class="pageContainer">
      <div id="teamLinks"></div>
    </div>


    <div id="teamContent" class="pageContainer">

      <!-- ===== PAGE TITLE ===== -->
      <div id="teamInfo"></div>
      <h1 id="pageTitle">Team Page</h1>
      <div id="image"></div>

      <!-- ===== PUBLIC CONTENT ===== -->
      <div class="publicContent">

        <!-- ===== MAIN + SIDEBAR CONTAINER ===== -->
        <div class="pcContainer container">
          <!-- ===== MAIN CONTENT ===== -->
          <div class="mainContent">
            <div id="editor"></div>

            <section class="block announcements">
              <h3 class="blockhead">Announcements</h3>
              <div id="announcements" class="cont"></div>
            </section>

            <section class="block calendar">
              <h3 class="blockhead">Upcoming Events</h3>
              <div id="events" class="cont"></div>
            </section>
          </div>

          <!-- ===== SIDEBAR ===== -->
          <aside class="sidebar">

            <!-- ===== QUICK LINKS ===== -->
            <div class="quickLinks" id="quickLinks">
              <p class="qlHed">Quick Links</p>
              <p class="qlP"><a href="https://volunteerpdx.net" target="_blank">Portland NET Wiki</a></p>
              <p class="qlP"><a href="https://app.betterimpact.com/" target="_blank">Log hours on MIP</a></p>
            </div>

            <section class="sidebar-section minutes">
              <h4>Meeting Minutes</h4>
              <div id="minutes" class="cont"></div>
            </section>

            <section class="sidebar-section ops">
              <h4>Operations Plan</h4>
              <div id="ops" class="cont"></div>
            </section>

            <section class="sidebar-section group">
              <h4>Google Group</h4>
              <div id="group" class="cont"></div>
            </section>

            <section class="sidebar-section drive">
              <h4>Team Drive</h4>
              <div id="drive" class="cont"></div>
            </section>

            <!-- ===== ADMIN / FOOTER ===== -->
              <div id="content"></div>

              <div id="adminButtons">
                <div id="teamUpdateContainer"></div>
                <button id="refreshBtn" hidden>Refresh data</button>
                <button id="loginBtn">Login</button>
                <button id="logoutBtn" hidden>Logout</button>
              </div>

              <div id="userInfo"></div>
            
          </aside>
        </div>
      </div>
    </div>
  </div>


  <!-- ===== JS IMPORTS ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { callBackend } from './js/api.js';
    import { renderTeamPage } from './js/teamRender.js';
    import { config } from './js/config.js';

    const app = initializeApp(config.firebase);
    const auth = getAuth(app);

    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const team = params.get('team') || '';

      const unsubscribe = onAuthStateChanged(auth, (user) => {
        unsubscribe();
        const email = user?.email || '';
        callBackend({ page: 'team', team, email })
          .then(data => {
            if (data?.error) console.error('Backend error:', data.error);
            else renderTeamPage(data);
          })
          .catch(err => console.error('Fetch error:', err));
      });

      // fallback fetch if auth not ready
      setTimeout(async () => {
        if (!auth.currentUser) {
          const data = await callBackend({ page: 'team', team, email: '' });
          if (!data?.error) renderTeamPage(data);
        }
      }, 2000);
    });
  </script>
</body>
</html>
